# Environment
dist: bionic
language: java

# Set up path
before_install:
  - export PATH=${PATH}:.

# Pre-download all maven dependencies
install: mvnw dependency:go-offline -e -B --no-transfer-progress

# Setup the code signing key; it will be used to publish snapshots and releases
before_script:
  - openssl aes-256-cbc -K $encrypted_59cd562a81f9_key -iv $encrypted_59cd562a81f9_iv
    -in deploy/code-signing-key.asc.enc -out deploy/code-signing-key.asc -d
  - gpg2 --batch --no-default-keyring --allow-secret-key-import --import deploy/code-signing-key.asc

# Integrate the latest and deploy snapshot artifacts to OSSRH
script: mvnw deploy -e -B --no-transfer-progress -settings .mvn/settings.xml -P ossrh

# Enable changes resulting from a release to be committed
before_deploy:
  - openssl aes-256-cbc -K $encrypted_59cd562a81f9_key -iv $encrypted_59cd562a81f9_iv
    -in deploy/id_rsa.enc -out ~/.ssh/id_rsa -d
  - chmod 400 ~/.ssh/id_rsa
  - git config --local user.name "Travis CI"
  - git config --local user.email "travis@travis-ci.com"

# Perform a release when the repository has been tagged
deploy:
  - on:
      tags: true
    provider: script
    script: deploy/release.sh
    skip_cleanup: true